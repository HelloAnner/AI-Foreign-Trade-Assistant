import{d as w,u as p,_ as T,B as k,C as M,D as P,w as x,f as V,c as L,a as U,b as t,s as y,E as A,k as r,v as d,G as I,l as B,z as C,o as D}from"./index-DGahl5ps.js";import{h as m}from"./http-CZPNIr2s.js";const K=async()=>{const{data:l}=await m.get("/settings");return l},N=async l=>{const{data:a}=await m.put("/settings",l);return a},R=async()=>{const{data:l}=await m.post("/settings/test-llm");return l},j=async()=>{const{data:l}=await m.post("/settings/test-smtp");return l},E=async()=>{const{data:l}=await m.post("/settings/test-search");return l},F=w("settings",{state:()=>({loading:!1,data:{llm_base_url:"",llm_api_key:"",llm_model:"",my_company_name:"",my_product_profile:"",smtp_host:"",smtp_port:465,smtp_username:"",smtp_password:"",admin_email:"",rating_guideline:"",search_provider:"",search_api_key:""}}),actions:{async fetchSettings(){const l=p();this.loading=!0;try{const a=await K();a.ok?this.data={...this.data,...a.data}:a.error&&l.pushToast(a.error,"error")}catch(a){console.error("Failed to load settings",a),l.pushToast(a.message,"error")}finally{this.loading=!1}},async saveSettings(l){const a=p();this.loading=!0;try{const o=await N({...this.data,...l});if(o.ok){const u=o.data||l;this.data={...this.data,...u},a.pushToast("配置已保存","success")}else o.error&&a.pushToast(o.error,"error")}catch(o){console.error("Failed to save settings",o),a.pushToast(o.message,"error")}finally{this.loading=!1}},async testLLM(){const l=p();try{const a=await R();a.ok?l.pushToast(a.data.message||"LLM 测试成功","success"):l.pushToast(a.error||"LLM 测试失败","error")}catch(a){l.pushToast(a.message,"error")}},async testSMTP(){const l=p();try{const a=await j();a.ok?l.pushToast("测试邮件已发送，请检查邮箱","success"):l.pushToast(a.error||"SMTP 测试失败","error")}catch(a){l.pushToast(a.message,"error")}},async testSearch(){const l=p();try{const a=await E();if(a.ok){const o=a.data?.message||"搜索 API 测试成功";l.pushToast(o,"success")}else l.pushToast(a.error||"搜索测试失败","error")}catch(a){l.pushToast(a.message,"error")}}}}),O={class:"settings-shell"},z={class:"main"},G={class:"card"},q={class:"grid"},H={class:"card"},J={class:"grid"},Q={class:"card"},W={class:"grid"},X={class:"grid-two"},Y={class:"card"},Z={class:"card card--stretch"},$={class:"card"},tt={class:"grid"},st={class:"form-footer"},at=["disabled"],et={__name:"SettingsPage",setup(l){const a=C(),o=F(),{data:u}=k(o),e=M({llm_base_url:"",llm_api_key:"",llm_model:"",my_company_name:"",my_product_profile:"",smtp_host:"",smtp_port:465,smtp_username:"",smtp_password:"",admin_email:"",rating_guideline:"",search_provider:"",search_api_key:""}),c=Object.keys(e);P(()=>{o.fetchSettings()}),x(u,i=>{i&&Object.assign(e,i)},{immediate:!0});const f=V(()=>u.value?c.some(i=>e[i]!==u.value[i]):c.some(i=>{const s=e[i];return s!==""&&s!==null&&s!==void 0})),v=async()=>f.value?(await o.saveSettings({...e}),!f.value):!0,g=async()=>{await o.saveSettings({...e})},b=async()=>{await v()&&await o.testLLM()},_=async()=>{await v()&&await o.testSMTP()},h=async()=>{await v()&&await o.testSearch()},S=()=>{a.push({name:"home"})};return(i,s)=>(D(),L("div",O,[s[37]||(s[37]=U('<aside class="sidebar" data-v-d170df51><div class="brand" data-v-d170df51><div class="avatar" data-v-d170df51></div><div data-v-d170df51><p class="brand-title" data-v-d170df51>AI外贸助手</p><p class="brand-sub" data-v-d170df51>专业版</p></div></div><nav class="menu" data-v-d170df51><button class="menu-item" data-v-d170df51><span class="material" data-v-d170df51>dashboard</span> Dashboard </button><button class="menu-item" data-v-d170df51><span class="material" data-v-d170df51>group</span> 客户管理 </button><button class="menu-item" data-v-d170df51><span class="material" data-v-d170df51>mail</span> 邮件营销 </button><button class="menu-item" data-v-d170df51><span class="material" data-v-d170df51>bar_chart</span> 数据分析 </button><button class="menu-item menu-item--active" data-v-d170df51><span class="material" data-v-d170df51>settings</span> 全局配置 </button></nav></aside>',1)),t("main",z,[t("header",{class:"page-head"},[s[14]||(s[14]=t("div",null,[t("h1",null,"全局配置"),t("p",null,"配置软件核心参数以确保 AI 助手正常运行。")],-1)),t("button",{class:"ghost",type:"button",onClick:S},[...s[13]||(s[13]=[t("span",{class:"material"},"arrow_back",-1),y(" 返回 ",-1)])])]),t("form",{class:"form",onSubmit:A(g,["prevent"])},[t("section",G,[t("header",null,[s[16]||(s[16]=t("div",null,[t("h2",null,"大模型 (LLM) 设置"),t("p",null,"配置 API 地址与密钥，用于智能分析与内容生成。")],-1)),t("button",{type:"button",class:"chip",onClick:b},[...s[15]||(s[15]=[t("span",{class:"material"},"bolt",-1),y(" 测试连接 ",-1)])])]),t("div",q,[t("label",null,[s[17]||(s[17]=t("span",null,"Base URL",-1)),r(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>e.llm_base_url=n),type:"text",placeholder:"https://api.example.com/v1"},null,512),[[d,e.llm_base_url]])]),t("label",null,[s[18]||(s[18]=t("span",null,"API Key",-1)),r(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.llm_api_key=n),type:"text",placeholder:"sk-..."},null,512),[[d,e.llm_api_key]])]),t("label",null,[s[19]||(s[19]=t("span",null,"模型名称",-1)),r(t("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>e.llm_model=n),type:"text",placeholder:"gpt-4o"},null,512),[[d,e.llm_model]])])])]),t("section",H,[s[22]||(s[22]=t("header",null,[t("div",null,[t("h2",null,"我的信息"),t("p",null,"这些信息将用于生成开发信签名与公司介绍。")])],-1)),t("div",J,[t("label",null,[s[20]||(s[20]=t("span",null,"我的公司名称",-1)),r(t("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>e.my_company_name=n),type:"text",placeholder:"例如：环球贸易有限公司"},null,512),[[d,e.my_company_name]])])]),t("label",null,[s[21]||(s[21]=t("span",null,"我的产品 / 服务简介",-1)),r(t("textarea",{"onUpdate:modelValue":s[4]||(s[4]=n=>e.my_product_profile=n),rows:"4",placeholder:"详细描述您的核心产品、优势和主要目标市场。"},null,512),[[d,e.my_product_profile]])])]),t("section",Q,[t("header",null,[s[24]||(s[24]=t("div",null,[t("h2",null,"邮件发送 (SMTP) 设置"),t("p",null,"配置用于自动发送跟进邮件的 SMTP 服务器。")],-1)),t("button",{type:"button",class:"chip",onClick:_},[...s[23]||(s[23]=[t("span",{class:"material"},"send",-1),y(" 发送测试邮件 ",-1)])])]),t("div",W,[t("label",null,[s[25]||(s[25]=t("span",null,"SMTP 服务器",-1)),r(t("input",{"onUpdate:modelValue":s[5]||(s[5]=n=>e.smtp_host=n),type:"text",placeholder:"smtp.example.com"},null,512),[[d,e.smtp_host]])]),t("label",null,[s[26]||(s[26]=t("span",null,"端口",-1)),r(t("input",{"onUpdate:modelValue":s[6]||(s[6]=n=>e.smtp_port=n),type:"number",placeholder:"465"},null,512),[[d,e.smtp_port,void 0,{number:!0}]])]),t("label",null,[s[27]||(s[27]=t("span",null,"邮箱账号",-1)),r(t("input",{"onUpdate:modelValue":s[7]||(s[7]=n=>e.smtp_username=n),type:"text",placeholder:"your@email.com"},null,512),[[d,e.smtp_username]])]),t("label",null,[s[28]||(s[28]=t("span",null,"邮箱密码 / 授权码",-1)),r(t("input",{"onUpdate:modelValue":s[8]||(s[8]=n=>e.smtp_password=n),type:"password",placeholder:"授权码"},null,512),[[d,e.smtp_password]])])])]),t("section",X,[t("div",Y,[s[30]||(s[30]=t("header",null,[t("div",null,[t("h2",null,"系统设置"),t("p",null,"全局通知与默认管理员设置。")])],-1)),t("label",null,[s[29]||(s[29]=t("span",null,"管理员邮箱",-1)),r(t("input",{"onUpdate:modelValue":s[9]||(s[9]=n=>e.admin_email=n),type:"email",placeholder:"用于接收系统通知"},null,512),[[d,e.admin_email]])])]),t("div",Z,[s[31]||(s[31]=t("header",null,[t("div",null,[t("h2",null,"客户评级标准"),t("p",null,"以自然语言描述您的 A/B/C 客户定义。")])],-1)),r(t("textarea",{"onUpdate:modelValue":s[10]||(s[10]=n=>e.rating_guideline=n),rows:"8",placeholder:`例如：
A级：明确表达采购意向，有具体需求和预算；
B级：对产品感兴趣，正在评估供应商；
C级：暂无明确需求，仅收集资料。`},null,512),[[d,e.rating_guideline]])])]),t("section",$,[t("header",null,[s[33]||(s[33]=t("div",null,[t("h2",null,"搜索 API 设置"),t("p",null,"配置用于外部情报搜索的 API。")],-1)),t("button",{type:"button",class:"chip",onClick:h},[...s[32]||(s[32]=[t("span",{class:"material"},"travel_explore",-1),y(" 测试搜索 ",-1)])])]),t("div",tt,[t("label",null,[s[35]||(s[35]=t("span",null,"搜索提供商",-1)),r(t("select",{"onUpdate:modelValue":s[11]||(s[11]=n=>e.search_provider=n)},[...s[34]||(s[34]=[t("option",{value:""},"未配置（直连模式）",-1),t("option",{value:"serpapi"},"SerpAPI",-1)])],512),[[I,e.search_provider]])]),t("label",null,[s[36]||(s[36]=t("span",null,"API Key",-1)),r(t("input",{"onUpdate:modelValue":s[12]||(s[12]=n=>e.search_api_key=n),type:"text",placeholder:"SerpAPI Key"},null,512),[[d,e.search_api_key]])])])]),t("footer",st,[t("button",{class:"primary",type:"submit",disabled:B(o).loading},"保存配置",8,at)])],32)])]))}},ot=T(et,[["__scopeId","data-v-d170df51"]]);export{ot as default};
