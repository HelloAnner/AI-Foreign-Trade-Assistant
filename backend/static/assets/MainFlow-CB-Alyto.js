import{_ as S,i as D,g as $,h as G,r as A,j as R,w as I,c as x,o as l,a as w,b as t,k as u,l as F,t as v,e as g,v as b,F as V,m as M,n as B,u as n,p as E,f as O,q as z,s as P,T as J}from"./index-Ch9j_YPl.js";import{F as T}from"./http-BlT6ntru.js";import{u as C}from"./flow-BAKyTzKt.js";import"./flow-ZQ2Q-dTR.js";const K={class:"card"},H={class:"card__head"},Q={key:0,class:"card__hint"},W={class:"grid"},X={class:"full"},Y={id:"country-options"},Z=["value"],ee={class:"overview"},te={class:"card"},se={key:0,class:"contacts"},ne=["onUpdate:modelValue"],oe=["onUpdate:modelValue"],le=["onUpdate:modelValue"],ae=["onUpdate:modelValue"],ie=["onClick","disabled"],re={key:1,class:"placeholder"},ue=["disabled"],de={__name:"StepOne",setup(N){const e=C(),m=D("flowNav",{goNext:()=>{}}),d=["美国","中国","加拿大","德国","法国","英国","日本","新加坡","澳大利亚","United States","Canada","Germany","France","United Kingdom","Japan","Singapore","Australia"],y=$(()=>{const c=new Set(d);return e.resolveResult?.country&&c.add(e.resolveResult.country),o.country&&c.add(o.country),Array.from(c)}),o=G({name:"",website:"",country:"",summary:""}),i=A([]),k=async c=>{const r=(c||"").trim();!r||e.resolving||await e.startResolve(r)};R(async()=>{!e.resolveResult&&e.query&&await k(e.query),p()});const p=()=>{e.resolveResult?(o.name=e.resolveResult.name||e.query||"",o.website=e.resolveResult.website||"",o.country=e.resolveResult.country||"",o.summary=e.resolveResult.summary||""):o.name=e.query||"",e.website&&(o.website=e.website),e.country&&(o.country=e.country),e.summary&&(o.summary=e.summary);const c=e.contacts&&e.contacts.length?e.contacts:e.resolveResult?.contacts||[];i.value=(c||[]).map(r=>({name:r.name||"",title:r.title||"",email:r.email||"",phone:r.phone||"",source:r.source||""})),i.value.length||i.value.push({name:"",title:"",email:"",phone:"",source:""})};I(()=>e.resolveResult,()=>{p()},{deep:!0}),I(()=>e.contacts,()=>{e.resolveResult||p()},{deep:!0}),I(()=>e.query,(c,r)=>{c&&c!==r&&!e.resolveResult&&k(c)});const s=()=>{i.value.push({name:"",title:"",email:"",phone:"",source:""})},a=c=>{i.value.length!==1&&i.value.splice(c,1)},f=$(()=>i.value.map((c,r)=>({name:c.name.trim(),title:c.title.trim(),email:c.email.trim(),phone:c.phone.trim(),source:c.source?.trim()||"",is_key:r===0}))),U=$(()=>!!(e.resolving||!o.website.trim()||!o.country.trim())),L=$(()=>o.summary?.trim()?o.summary.trim():e.resolveResult?.summary?e.resolveResult.summary:"暂无概述，生成分析后将自动补全。"),j=async()=>{U.value||(o.name||(o.name=e.query||o.website),e.contacts=f.value,await e.saveCompany({name:o.name,website:o.website,country:o.country,summary:o.summary}),m.goNext?.())};return(c,r)=>(l(),x(T,{step:1,total:5,title:"Step 1: 智能信息获取与聚合",subtitle:"请核对 AI 自动拉取的客户信息，可按需补充后继续。"},{footer:w(()=>[t("button",{class:"primary",type:"button",disabled:U.value,onClick:j},v(n(e).resolving?"同步中…":"下一步"),9,ue)]),default:w(()=>[t("section",K,[t("header",H,[r[2]||(r[2]=t("div",null,[t("h2",null,"客户基础信息"),t("p",null,"官网与国家为后续分析的关键依据。")],-1)),o.name?(l(),u("p",Q,"客户名称："+v(o.name),1)):F("",!0)]),t("div",W,[t("label",X,[r[3]||(r[3]=t("span",null,"公司官网",-1)),g(t("input",{"onUpdate:modelValue":r[0]||(r[0]=_=>o.website=_),type:"text",placeholder:"https://www.example.com"},null,512),[[b,o.website]])]),t("label",null,[r[4]||(r[4]=t("span",null,"国家/地区",-1)),g(t("input",{"onUpdate:modelValue":r[1]||(r[1]=_=>o.country=_),type:"text",list:"country-options",placeholder:"例如：美国 / United States"},null,512),[[b,o.country]]),t("datalist",Y,[(l(!0),u(V,null,M(y.value,_=>(l(),u("option",{key:_,value:_},null,8,Z))),128))])])]),t("div",ee,[r[5]||(r[5]=t("span",null,"客户基本信息概述",-1)),t("p",null,v(L.value),1)])]),t("section",te,[t("header",{class:"card__head"},[r[7]||(r[7]=t("div",null,[t("h2",null,"潜在联系人"),t("p",null,"至少保留一位业务联系人，便于后续外联。")],-1)),t("button",{class:"ghost",type:"button",onClick:s},[...r[6]||(r[6]=[t("span",{class:"material"},"add",-1),B(" 新增联系人 ",-1)])])]),i.value.length?(l(),u("div",se,[(l(!0),u(V,null,M(i.value,(_,q)=>(l(),u("div",{key:q,class:"contact-row"},[g(t("input",{"onUpdate:modelValue":h=>_.name=h,type:"text",placeholder:"姓名"},null,8,ne),[[b,_.name]]),g(t("input",{"onUpdate:modelValue":h=>_.title=h,type:"text",placeholder:"职位"},null,8,oe),[[b,_.title]]),g(t("input",{"onUpdate:modelValue":h=>_.email=h,type:"email",placeholder:"邮箱"},null,8,le),[[b,_.email]]),g(t("input",{"onUpdate:modelValue":h=>_.phone=h,type:"text",placeholder:"电话（选填）"},null,8,ae),[[b,_.phone]]),t("button",{class:"icon-button",type:"button",onClick:h=>a(q),disabled:i.value.length===1},[...r[8]||(r[8]=[t("span",{class:"material"},"delete",-1)])],8,ie)]))),128))])):(l(),u("p",re,"暂无联系人，点击右上角按钮新增。"))])]),_:1}))}},pe=S(de,[["__scopeId","data-v-48b50f51"]]),ce={class:"rating-card"},me={key:0,class:"rating-card__placeholder"},ye={key:1,class:"rating-card__content"},_e={key:0,class:"rating-card__spinner"},ve={class:"reason"},fe={class:"actions"},ge={key:2,class:"status"},be={key:0},ke={__name:"StepTwo",setup(N){const e=C(),m=D("flowNav",{}),d=()=>{!e.customerId||e.loading.grade||e.gradeSuggestion||e.fetchGrade()};R(()=>{d()}),I(()=>e.customerId,()=>{d()});const y=async o=>{if(!e.customerId)return;const i=e.gradeSuggestion?.reason||"";await e.confirmGrade(o,i),o==="A"?m.goNext?.():m.goTo?.(4)};return(o,i)=>(l(),x(T,{step:2,total:5,title:"Step 2: AI 辅助客户价值评级",subtitle:"系统根据客户画像自动给出评级，确认后进入下一步。"},{default:w(()=>[t("section",ce,[n(e).customerId?(l(),u("div",ye,[n(e).loading.grade||!n(e).gradeSuggestion?(l(),u("div",_e,[...i[3]||(i[3]=[t("div",{class:"spinner"},null,-1),t("p",null,"AI 正在进行价值评估…",-1)])])):(l(),u(V,{key:1},[i[4]||(i[4]=t("p",{class:"label"},"AI 推荐评级",-1)),t("div",{class:E(["badge",`badge--${n(e).gradeSuggestion.suggested_grade.toLowerCase()}`])},v(n(e).gradeSuggestion.suggested_grade)+"级 ",3),t("p",ve,"理由："+v(n(e).gradeSuggestion.reason),1),t("div",fe,[t("button",{type:"button",class:"solid",onClick:i[0]||(i[0]=k=>y("A"))},"确认 A级（继续分析）"),t("button",{type:"button",class:"outline",onClick:i[1]||(i[1]=k=>y("B"))},"调整为 B级（归档）"),t("button",{type:"button",class:"outline",onClick:i[2]||(i[2]=k=>y("C"))},"调整为 C级（忽略）")])],64)),n(e).gradeFinal?(l(),u("div",ge,[t("span",null,"当前等级："+v(n(e).gradeFinal.grade),1),n(e).gradeFinal.reason?(l(),u("small",be,"理由："+v(n(e).gradeFinal.reason),1)):F("",!0)])):F("",!0)])):(l(),u("div",me,"请先完成 Step 1 并保存客户信息。"))])]),_:1}))}},we=S(ke,[["__scopeId","data-v-861085d0"]]),he={class:"analysis"},$e={key:0,class:"analysis__loading"},xe={key:1,class:"analysis__empty"},Se={key:2,class:"analysis__body"},Ce={class:"section"},Ne={key:1,class:"text-block"},Ie={class:"section"},Fe={key:1,class:"text-block"},De={class:"section"},Te={key:1,class:"text-block"},Ue={class:"section"},Ve={key:1,class:"text-block"},Ae=["disabled"],Re={__name:"StepThree",setup(N){const e=C(),m=D("flowNav",{}),d=A(!1),y=()=>{!e.customerId||e.loading.analysis||e.analysis||e.fetchAnalysis()};R(()=>{y()});const o=()=>{y()},i=()=>{d.value=!d.value},k=async()=>{e.analysis&&(await e.persistAnalysis(),e.step=Math.max(e.step,4),m.goNext?.())};return(p,s)=>(l(),x(T,{step:3,total:5,title:"Step 3: 生成产品切入点分析",subtitle:"AI 根据客户信息生成可编辑的分析报告。"},{footer:w(()=>[t("button",{class:"ghost",type:"button",onClick:s[4]||(s[4]=a=>n(m).goPrev?.())},"返回上一步"),t("button",{class:"primary",type:"button",disabled:!n(e).analysis||n(e).loading.analysis,onClick:k}," 保存并继续 ",8,Ae)]),default:w(()=>[t("section",he,[n(e).loading.analysis?(l(),u("div",$e,[...s[5]||(s[5]=[t("div",{class:"spinner"},null,-1),t("p",null,"正在生成切入点分析…",-1),t("small",null,"AI 正在为您深度分析客户需求，请稍候。",-1)])])):n(e).analysis?(l(),u("div",Se,[t("header",null,[s[8]||(s[8]=t("h2",null,"AI 产品切入点建议",-1)),t("button",{type:"button",class:"ghost",onClick:i},[s[7]||(s[7]=t("span",{class:"material"},"edit",-1)),B(" "+v(d.value?"完成编辑":"编辑"),1)])]),t("div",Ce,[s[9]||(s[9]=t("span",null,"客户核心业务",-1)),d.value?g((l(),u("textarea",{key:0,"onUpdate:modelValue":s[0]||(s[0]=a=>n(e).analysis.core_business=a),rows:"3"},null,512)),[[b,n(e).analysis.core_business]]):(l(),u("div",Ne,v(n(e).analysis.core_business),1))]),t("div",Ie,[s[10]||(s[10]=t("span",null,"潜在需求 / 痛点",-1)),d.value?g((l(),u("textarea",{key:0,"onUpdate:modelValue":s[1]||(s[1]=a=>n(e).analysis.pain_points=a),rows:"4"},null,512)),[[b,n(e).analysis.pain_points]]):(l(),u("div",Fe,v(n(e).analysis.pain_points),1))]),t("div",De,[s[11]||(s[11]=t("span",null,"我方切入点",-1)),d.value?g((l(),u("textarea",{key:0,"onUpdate:modelValue":s[2]||(s[2]=a=>n(e).analysis.my_entry_points=a),rows:"4"},null,512)),[[b,n(e).analysis.my_entry_points]]):(l(),u("div",Te,v(n(e).analysis.my_entry_points),1))]),t("div",Ue,[s[12]||(s[12]=t("span",null,"完整报告",-1)),d.value?g((l(),u("textarea",{key:0,"onUpdate:modelValue":s[3]||(s[3]=a=>n(e).analysis.full_report=a),rows:"6"},null,512)),[[b,n(e).analysis.full_report]]):(l(),u("div",Ve,v(n(e).analysis.full_report),1))])])):(l(),u("div",xe,[s[6]||(s[6]=t("p",null,"暂无分析内容，点击下方按钮生成。",-1)),t("button",{type:"button",class:"primary",onClick:o},"生成分析")]))])]),_:1}))}},Me=S(Re,[["__scopeId","data-v-1b73c9bc"]]),qe={class:"mail-card"},Be={key:0,class:"mail-card__loading"},Ee={key:1,class:"mail-card__empty"},Le={key:2,class:"mail-card__body"},je=["disabled"],Ge={__name:"StepFour",setup(N){const e=C(),m=D("flowNav",{}),d=A(""),y=()=>{!e.customerId||e.loading.email||e.emailDraft||e.generateEmail()};R(()=>{y()});const o=()=>{y()},i=async()=>{e.emailDraft&&(await e.saveInitialFollowup(d.value),m.goNext?.())};return(k,p)=>(l(),x(T,{step:4,total:5,title:"Step 4: 生成个性化开发信",subtitle:"确认并微调邮件内容，保存为首次跟进记录。"},{footer:w(()=>[t("button",{class:"primary",type:"button",disabled:!n(e).emailDraft||n(e).loading.followup||n(e).loading.email,onClick:i},v(n(e).loading.followup?"保存中…":"保存为首次跟进记录"),9,je)]),default:w(()=>[t("section",qe,[n(e).loading.email?(l(),u("div",Be,[...p[3]||(p[3]=[t("div",{class:"spinner"},null,-1),t("p",null,"正在生成个性化开发信…",-1)])])):n(e).emailDraft?(l(),u("div",Le,[t("label",null,[p[5]||(p[5]=t("span",null,"邮件标题",-1)),g(t("input",{"onUpdate:modelValue":p[0]||(p[0]=s=>n(e).emailDraft.subject=s),type:"text"},null,512),[[b,n(e).emailDraft.subject]])]),t("label",null,[p[6]||(p[6]=t("span",null,"邮件正文",-1)),g(t("textarea",{"onUpdate:modelValue":p[1]||(p[1]=s=>n(e).emailDraft.body=s),rows:"12"},null,512),[[b,n(e).emailDraft.body]])]),t("label",null,[p[7]||(p[7]=t("span",null,"首次跟进备注（选填）",-1)),g(t("textarea",{"onUpdate:modelValue":p[2]||(p[2]=s=>d.value=s),rows:"4",placeholder:"记录与客户沟通的背景或期待的行动"},null,512),[[b,d.value]])])])):(l(),u("div",Ee,[p[4]||(p[4]=t("p",null,"尚未生成开发信草稿，点击下方按钮立即生成。",-1)),t("button",{type:"button",class:"primary",onClick:o},"生成开发信")]))])]),_:1}))}},Oe=S(Ge,[["__scopeId","data-v-0469c86e"]]),ze={class:"schedule-card"},Pe={class:"options"},Je=["disabled","onClick"],Ke={key:0,class:"hint"},He={key:1,class:"status pending"},Qe={key:2,class:"status success"},We={__name:"StepFive",setup(N){const e=C(),m=D("flowNav",{}),d=O(),y=[3,7,14],o=s=>{if(!e.scheduledTask||!e.scheduledTask.due_at)return!1;const a=new Date(e.scheduledTask.due_at),f=new Date(e.scheduledTask.created_at);return Number.isNaN(a.getTime())||Number.isNaN(f.getTime())?!1:Math.round((a-f)/(1e3*60*60*24))===s},i=s=>{e.emailDraft&&e.createSchedule(s)},k=s=>{if(!s)return"";const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toLocaleString()},p=()=>{e.resetFlow(),m.goTo?.(0),d.push({name:"home"})};return(s,a)=>(l(),x(T,{step:5,total:5,title:"Step 5: 设置自动化邮件跟进",subtitle:"选择合适的跟进时间，AI 会在约定日期自动发送邮件。"},{footer:w(()=>[t("button",{class:"primary",type:"button",onClick:p},"完成并开始下一个")]),default:w(()=>[t("section",ze,[a[2]||(a[2]=t("h2",null,"设置自动跟进邮件",-1)),t("div",Pe,[(l(),u(V,null,M(y,f=>t("button",{key:f,type:"button",class:E(["option",{active:o(f)}]),disabled:n(e).loading.schedule||!n(e).emailDraft,onClick:U=>i(f)},v(f)+" 天后跟进 ",11,Je)),64))]),n(e).emailDraft?F("",!0):(l(),u("p",Ke,"需先保存开发信草稿才能安排自动跟进。")),n(e).loading.schedule?(l(),u("div",He,[...a[0]||(a[0]=[t("div",{class:"spinner"},null,-1),t("span",null,"正在创建跟进任务…",-1)])])):n(e).scheduledTask?(l(),u("div",Qe,[a[1]||(a[1]=t("span",{class:"material"},"check_circle",-1)),t("span",null,"任务设置成功！AI 将在 "+v(k(n(e).scheduledTask.due_at))+" 自动发送跟进邮件。",1)])):F("",!0)])]),_:1}))}},Xe=S(We,[["__scopeId","data-v-a20957b7"]]),Ye={__name:"MainFlow",setup(N){const e=C(),m=[{id:1,component:pe},{id:2,component:we},{id:3,component:Me},{id:4,component:Oe},{id:5,component:Xe}],d=A(Math.max(0,e.step-1)),y=$(()=>Math.max(e.step-1,0)),o=$(()=>m[Math.min(d.value,m.length-1)]),i=()=>{d.value!==0&&(d.value-=1,s())},k=()=>{d.value>=m.length-1||d.value>=y.value||(d.value+=1,s())},p=a=>{a<0||a>=m.length||a>y.value||(d.value=a,s())},s=()=>{const a=d.value+1;a>e.step&&(e.step=a)};return I(()=>e.step,a=>{const f=Math.max(0,Math.min(a-1,m.length-1));f!==d.value&&(d.value=f)}),z("flowNav",{goPrev:i,goNext:k,goTo:p,activeIndex:$(()=>d.value),unlockIndex:y}),(a,f)=>(l(),x(J,{name:"flow-fade",mode:"out-in"},{default:w(()=>[(l(),x(P(o.value.component),{key:o.value.id}))]),_:1}))}},nt=S(Ye,[["__scopeId","data-v-ff369837"]]);export{nt as default};
