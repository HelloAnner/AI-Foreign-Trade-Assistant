import{x as M,y as d,_ as V,B as x,h as U,j as P,w as L,g as A,c as B,a as _,b as t,n as g,e as n,v as i,z as f,D as C,E as I,k as j,l as q,T as F,d as N,u as O,o as w}from"./index-Ch9j_YPl.js";import{h as p,F as D}from"./http-BlT6ntru.js";const K=async()=>{const{data:o}=await p.get("/settings");return o},R=async o=>{const{data:l}=await p.put("/settings",o);return l},E=async()=>{const{data:o}=await p.post("/settings/test-llm");return o},z=async()=>{const{data:o}=await p.post("/settings/test-smtp");return o},$=async()=>{const{data:o}=await p.post("/settings/test-search");return o},c=()=>({loading:!1,data:{llm_base_url:"",llm_api_key:"",llm_model:"",my_company_name:"",my_product_profile:"",smtp_host:"",smtp_port:465,smtp_username:"",smtp_password:"",admin_email:"",rating_guideline:"",search_provider:"",search_api_key:"",automation_enabled:!1,automation_followup_days:7,automation_required_grade:"A"}}),G=M("settings",{state:c,actions:{async fetchSettings(){const o=d();this.loading=!0;try{const l=await K();l.ok?this.data={...this.data,...l.data}:l.error&&o.pushToast(l.error,"error")}catch(l){console.error("Failed to load settings",l),o.pushToast(l.message,"error")}finally{this.loading=!1}},async saveSettings(o){const l=d();this.loading=!0;try{const r=await R({...this.data,...o});if(r.ok){const e=r.data||o;this.data={...this.data,...e},l.pushToast("配置已保存","success")}else r.error&&l.pushToast(r.error,"error")}catch(r){console.error("Failed to save settings",r),l.pushToast(r.message,"error")}finally{this.loading=!1}},async testLLM(){const o=d();try{const l=await E();l.ok?o.pushToast(l.data.message||"LLM 测试成功","success"):o.pushToast(l.error||"LLM 测试失败","error")}catch(l){o.pushToast(l.message,"error")}},async testSMTP(){const o=d();try{const l=await z();l.ok?o.pushToast("测试邮件已发送，请检查邮箱","success"):o.pushToast(l.error||"SMTP 测试失败","error")}catch(l){o.pushToast(l.message,"error")}},async testSearch(){const o=d();try{const l=await $();if(l.ok){const r=l.data?.message||"搜索 API 测试成功";o.pushToast(r,"success")}else o.pushToast(l.error||"搜索测试失败","error")}catch(l){o.pushToast(l.message,"error")}},reset(){Object.assign(this.$state,c())}}}),H={class:"card"},J={class:"grid"},Q={class:"card"},W={class:"grid"},X={class:"full"},Y={class:"card"},Z={class:"grid"},tt={class:"grid-two"},st={class:"card"},et={class:"card"},lt={class:"card"},at={class:"grid"},ot={class:"card"},nt={class:"switch"},rt={key:0,class:"automation-grid"},it={class:"form-actions"},ut=["disabled"],dt=["disabled"],pt={__name:"SettingsPage",setup(o){const l=G(),{data:r}=x(l),e=U({llm_base_url:"",llm_api_key:"",llm_model:"",my_company_name:"",my_product_profile:"",smtp_host:"",smtp_port:465,smtp_username:"",smtp_password:"",admin_email:"",rating_guideline:"",search_provider:"",search_api_key:"",automation_enabled:!1,automation_followup_days:7,automation_required_grade:"A"}),b=Object.keys(e);P(()=>{l.fetchSettings()}),L(r,u=>{u&&Object.assign(e,u)},{immediate:!0});const m=A(()=>r.value?b.some(u=>e[u]!==r.value[u]):b.some(u=>{const s=e[u];return s!==""&&s!==null&&s!==void 0})),y=async()=>m.value?(await l.saveSettings({...e}),!m.value):!0,v=async()=>{await l.saveSettings({...e})},S=async()=>{await y()&&await l.testLLM()},T=()=>{r.value?Object.assign(e,r.value):(e.automation_enabled=!1,e.automation_followup_days=7,e.automation_required_grade="A")},h=async()=>{await y()&&await l.testSMTP()},k=async()=>{await y()&&await l.testSearch()};return(u,s)=>(w(),B(D,{step:1,total:1,title:"全局配置",subtitle:"配置软件核心参数，保障 AI 助手稳定运行。"},{footer:_(()=>[t("div",it,[t("button",{class:"ghost",type:"button",disabled:!m.value,onClick:T},"取消",8,ut),t("button",{class:"primary",type:"button",disabled:O(l).loading,onClick:v},"保存更改",8,dt)])]),default:_(()=>[t("form",{id:"settings-form",class:"settings-form",onSubmit:N(v,["prevent"])},[t("section",H,[t("header",null,[s[17]||(s[17]=t("div",null,[t("h2",null,"大模型 (LLM) 设置"),t("p",null,"配置 API 地址与密钥，用于智能分析与内容生成。")],-1)),t("button",{type:"button",class:"chip",onClick:S},[...s[16]||(s[16]=[t("span",{class:"material"},"bolt",-1),g(" 测试连接 ",-1)])])]),t("div",J,[t("label",null,[s[18]||(s[18]=t("span",null,"Base URL",-1)),n(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>e.llm_base_url=a),type:"text",placeholder:"https://api.example.com/v1"},null,512),[[i,e.llm_base_url]])]),t("label",null,[s[19]||(s[19]=t("span",null,"API Key",-1)),n(t("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>e.llm_api_key=a),type:"password",placeholder:"••••••"},null,512),[[i,e.llm_api_key]])]),t("label",null,[s[20]||(s[20]=t("span",null,"模型名称",-1)),n(t("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>e.llm_model=a),type:"text",placeholder:"gpt-4o"},null,512),[[i,e.llm_model]])])])]),t("section",Q,[s[23]||(s[23]=t("header",null,[t("div",null,[t("h2",null,"我的信息"),t("p",null,"这些信息将用于生成开发信签名与公司介绍。")])],-1)),t("div",W,[t("label",null,[s[21]||(s[21]=t("span",null,"我的公司名称",-1)),n(t("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>e.my_company_name=a),type:"text",placeholder:"例如：环球贸易有限公司"},null,512),[[i,e.my_company_name]])])]),t("label",X,[s[22]||(s[22]=t("span",null,"我的产品 / 服务简介",-1)),n(t("textarea",{"onUpdate:modelValue":s[4]||(s[4]=a=>e.my_product_profile=a),rows:"4",placeholder:"详细描述您的核心产品、优势和主要目标市场。"},null,512),[[i,e.my_product_profile]])])]),t("section",Y,[t("header",null,[s[25]||(s[25]=t("div",null,[t("h2",null,"邮件发送 (SMTP) 设置"),t("p",null,"配置用于自动发送跟进邮件的 SMTP 服务器。")],-1)),t("button",{type:"button",class:"chip",onClick:h},[...s[24]||(s[24]=[t("span",{class:"material"},"send",-1),g(" 发送测试邮件 ",-1)])])]),t("div",Z,[t("label",null,[s[26]||(s[26]=t("span",null,"SMTP 服务器",-1)),n(t("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>e.smtp_host=a),type:"text",placeholder:"smtp.example.com"},null,512),[[i,e.smtp_host]])]),t("label",null,[s[27]||(s[27]=t("span",null,"端口",-1)),n(t("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>e.smtp_port=a),type:"number",placeholder:"465"},null,512),[[i,e.smtp_port,void 0,{number:!0}]])]),t("label",null,[s[28]||(s[28]=t("span",null,"邮箱账号",-1)),n(t("input",{"onUpdate:modelValue":s[7]||(s[7]=a=>e.smtp_username=a),type:"text",placeholder:"your@email.com"},null,512),[[i,e.smtp_username]])]),t("label",null,[s[29]||(s[29]=t("span",null,"邮箱密码 / 授权码",-1)),n(t("input",{"onUpdate:modelValue":s[8]||(s[8]=a=>e.smtp_password=a),type:"password",placeholder:"••••••"},null,512),[[i,e.smtp_password]])])])]),t("section",tt,[t("div",st,[s[31]||(s[31]=t("header",null,[t("div",null,[t("h2",null,"系统设置"),t("p",null,"全局通知与默认管理员设置。")])],-1)),t("label",null,[s[30]||(s[30]=t("span",null,"管理员邮箱",-1)),n(t("input",{"onUpdate:modelValue":s[9]||(s[9]=a=>e.admin_email=a),type:"email",placeholder:"用于接收系统通知"},null,512),[[i,e.admin_email]])])]),t("div",et,[s[32]||(s[32]=t("header",null,[t("div",null,[t("h2",null,"客户评级标准"),t("p",null,"以自然语言描述您的 A/B/C 客户定义。")])],-1)),n(t("textarea",{"onUpdate:modelValue":s[10]||(s[10]=a=>e.rating_guideline=a),rows:"8",placeholder:`例如：
A级：明确表达采购意向，有具体需求和预算；
B级：对产品感兴趣，正在评估供应商；
C级：暂无明确需求，仅收集资料。`},null,512),[[i,e.rating_guideline]])])]),t("section",lt,[t("header",null,[s[34]||(s[34]=t("div",null,[t("h2",null,"搜索 API 设置"),t("p",null,"配置用于外部情报搜索的 API。")],-1)),t("button",{type:"button",class:"chip",onClick:k},[...s[33]||(s[33]=[t("span",{class:"material"},"travel_explore",-1),g(" 测试搜索 ",-1)])])]),t("div",at,[t("label",null,[s[36]||(s[36]=t("span",null,"搜索提供商",-1)),n(t("select",{"onUpdate:modelValue":s[11]||(s[11]=a=>e.search_provider=a)},[...s[35]||(s[35]=[t("option",{value:""},"未配置（直连模式）",-1),t("option",{value:"serpapi"},"SerpAPI",-1)])],512),[[f,e.search_provider]])]),t("label",null,[s[37]||(s[37]=t("span",null,"API Key",-1)),n(t("input",{"onUpdate:modelValue":s[12]||(s[12]=a=>e.search_api_key=a),type:"password",placeholder:"••••••"},null,512),[[i,e.search_api_key]])])])]),t("section",ot,[t("header",null,[s[40]||(s[40]=t("div",null,[t("h2",null,"自动化分析"),t("p",null,"如果开启，新增客户的每一步都会自动运行，并按默认配置保存结果。")],-1)),t("label",nt,[n(t("input",{class:"switch__input",type:"checkbox","onUpdate:modelValue":s[13]||(s[13]=a=>e.automation_enabled=a)},null,512),[[I,e.automation_enabled]]),s[38]||(s[38]=t("span",{class:"switch__slider"},null,-1)),s[39]||(s[39]=t("span",{class:"switch__label"},"自动化分析",-1))])]),C(F,{name:"fade"},{default:_(()=>[e.automation_enabled?(w(),j("div",rt,[t("label",null,[s[42]||(s[42]=t("span",null,"默认跟进间隔",-1)),n(t("select",{"onUpdate:modelValue":s[14]||(s[14]=a=>e.automation_followup_days=a)},[...s[41]||(s[41]=[t("option",{value:3},"3 天",-1),t("option",{value:7},"7 天",-1),t("option",{value:14},"14 天",-1)])],512),[[f,e.automation_followup_days,void 0,{number:!0}]])]),t("label",null,[s[44]||(s[44]=t("span",null,"继续分析的最低评级",-1)),n(t("select",{"onUpdate:modelValue":s[15]||(s[15]=a=>e.automation_required_grade=a)},[...s[43]||(s[43]=[t("option",{value:"S"},"S 级",-1),t("option",{value:"A"},"A级",-1),t("option",{value:"B"},"B级",-1)])],512),[[f,e.automation_required_grade]])])])):q("",!0)]),_:1})])],32)]),_:1}))}},_t=V(pt,[["__scopeId","data-v-366b19d7"]]);export{_t as default};
