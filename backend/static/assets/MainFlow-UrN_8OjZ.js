import{_ as x,i as F,g as L,r as A,h as U,w as N,j as I,c as $,o,a as w,b as t,k as u,l as D,t as v,e as b,v as k,F as V,m as M,n as j,p as B,u as n,q as E,f as G,s as O,x as z,T as P}from"./index-BM-Gany5.js";import{F as T}from"./http-Erw2iPVe.js";import{u as S}from"./flow-B6DhMcKr.js";import"./flow-C-HfUBK2.js";const H={class:"card"},J={class:"card__head"},K={key:0,class:"card__hint"},Q={class:"grid"},W={class:"full"},X=["value"],Y={class:"card"},Z={key:0,class:"contacts"},ee=["onUpdate:modelValue"],te=["onUpdate:modelValue"],se=["onUpdate:modelValue"],ne=["onUpdate:modelValue"],le=["onClick","disabled"],oe={key:1,class:"placeholder"},ae=["disabled"],ie={__name:"StepOne",setup(C){const e=S(),m=F("flowNav",{goNext:()=>{}}),r=["美国","德国","新加坡","英国","日本","中国","加拿大"],l=L({name:"",website:"",country:"",summary:""}),d=A([]),p=async _=>{const i=(_||"").trim();!i||e.resolving||await e.startResolve(i)};U(async()=>{!e.resolveResult&&e.query&&await p(e.query),g()});const g=()=>{e.resolveResult?(l.name=e.resolveResult.name||e.query||"",l.website=e.resolveResult.website||"",l.country=e.resolveResult.country||"",l.summary=e.resolveResult.summary||""):l.name=e.query||"",e.website&&(l.website=e.website),e.country&&(l.country=e.country),e.summary&&(l.summary=e.summary);const _=e.contacts&&e.contacts.length?e.contacts:e.resolveResult?.contacts||[];d.value=(_||[]).map(i=>({name:i.name||"",title:i.title||"",email:i.email||"",phone:i.phone||"",source:i.source||""})),d.value.length||d.value.push({name:"",title:"",email:"",phone:"",source:""})};N(()=>e.resolveResult,()=>{g()},{deep:!0}),N(()=>e.contacts,()=>{e.resolveResult||g()},{deep:!0}),N(()=>e.query,(_,i)=>{_&&_!==i&&!e.resolveResult&&p(_)});const c=()=>{d.value.push({name:"",title:"",email:"",phone:"",source:""})},s=_=>{d.value.length!==1&&d.value.splice(_,1)},a=I(()=>d.value.map((_,i)=>({name:_.name.trim(),title:_.title.trim(),email:_.email.trim(),phone:_.phone.trim(),source:_.source?.trim()||"",is_key:i===0}))),f=I(()=>!!(e.resolving||!l.website.trim()||!l.country.trim())),R=async()=>{f.value||(l.name||(l.name=e.query||l.website),e.contacts=a.value,await e.saveCompany({name:l.name,website:l.website,country:l.country,summary:l.summary}),m.goNext?.())};return(_,i)=>(o(),$(T,{step:1,total:5,title:"Step 1: 智能信息获取与聚合",subtitle:"请核对 AI 自动拉取的客户信息，可按需补充后继续。"},{footer:w(()=>[t("button",{class:"primary",type:"button",disabled:f.value,onClick:R},v(n(e).resolving?"同步中…":"下一步"),9,ae)]),default:w(()=>[t("section",H,[t("header",J,[i[2]||(i[2]=t("div",null,[t("h2",null,"客户基础信息"),t("p",null,"官网与国家为后续分析的关键依据。")],-1)),l.name?(o(),u("p",K,"客户名称："+v(l.name),1)):D("",!0)]),t("div",Q,[t("label",W,[i[3]||(i[3]=t("span",null,"公司官网",-1)),b(t("input",{"onUpdate:modelValue":i[0]||(i[0]=y=>l.website=y),type:"text",placeholder:"https://www.example.com"},null,512),[[k,l.website]])]),t("label",null,[i[5]||(i[5]=t("span",null,"国家/地区",-1)),b(t("select",{"onUpdate:modelValue":i[1]||(i[1]=y=>l.country=y)},[i[4]||(i[4]=t("option",{value:""},"请选择",-1)),(o(),u(V,null,M(r,y=>t("option",{key:y,value:y},v(y),9,X)),64))],512),[[j,l.country]])])])]),t("section",Y,[t("header",{class:"card__head"},[i[7]||(i[7]=t("div",null,[t("h2",null,"潜在联系人"),t("p",null,"至少保留一位业务联系人，便于后续外联。")],-1)),t("button",{class:"ghost",type:"button",onClick:c},[...i[6]||(i[6]=[t("span",{class:"material"},"add",-1),B(" 新增联系人 ",-1)])])]),d.value.length?(o(),u("div",Z,[(o(!0),u(V,null,M(d.value,(y,q)=>(o(),u("div",{key:q,class:"contact-row"},[b(t("input",{"onUpdate:modelValue":h=>y.name=h,type:"text",placeholder:"姓名"},null,8,ee),[[k,y.name]]),b(t("input",{"onUpdate:modelValue":h=>y.title=h,type:"text",placeholder:"职位"},null,8,te),[[k,y.title]]),b(t("input",{"onUpdate:modelValue":h=>y.email=h,type:"email",placeholder:"邮箱"},null,8,se),[[k,y.email]]),b(t("input",{"onUpdate:modelValue":h=>y.phone=h,type:"text",placeholder:"电话（选填）"},null,8,ne),[[k,y.phone]]),t("button",{class:"icon-button",type:"button",onClick:h=>s(q),disabled:d.value.length===1},[...i[8]||(i[8]=[t("span",{class:"material"},"delete",-1)])],8,le)]))),128))])):(o(),u("p",oe,"暂无联系人，点击右上角按钮新增。"))])]),_:1}))}},re=x(ie,[["__scopeId","data-v-a00d7a70"]]),ue={class:"rating-card"},de={key:0,class:"rating-card__placeholder"},pe={key:1,class:"rating-card__content"},ce={key:0,class:"rating-card__spinner"},me={class:"reason"},_e={class:"actions"},ye={key:2,class:"status"},ve={key:0},fe={__name:"StepTwo",setup(C){const e=S(),m=F("flowNav",{}),r=()=>{!e.customerId||e.loading.grade||e.gradeSuggestion||e.fetchGrade()};U(()=>{r()}),N(()=>e.customerId,()=>{r()});const l=async d=>{if(!e.customerId)return;const p=e.gradeSuggestion?.reason||"";await e.confirmGrade(d,p),d==="A"?m.goNext?.():m.goTo?.(4)};return(d,p)=>(o(),$(T,{step:2,total:5,title:"Step 2: AI 辅助客户价值评级",subtitle:"系统根据客户画像自动给出评级，确认后进入下一步。"},{default:w(()=>[t("section",ue,[n(e).customerId?(o(),u("div",pe,[n(e).loading.grade||!n(e).gradeSuggestion?(o(),u("div",ce,[...p[3]||(p[3]=[t("div",{class:"spinner"},null,-1),t("p",null,"AI 正在进行价值评估…",-1)])])):(o(),u(V,{key:1},[p[4]||(p[4]=t("p",{class:"label"},"AI 推荐评级",-1)),t("div",{class:E(["badge",`badge--${n(e).gradeSuggestion.suggested_grade.toLowerCase()}`])},v(n(e).gradeSuggestion.suggested_grade)+"级 ",3),t("p",me,"理由："+v(n(e).gradeSuggestion.reason),1),t("div",_e,[t("button",{type:"button",class:"solid",onClick:p[0]||(p[0]=g=>l("A"))},"确认 A级（继续分析）"),t("button",{type:"button",class:"outline",onClick:p[1]||(p[1]=g=>l("B"))},"调整为 B级（归档）"),t("button",{type:"button",class:"outline",onClick:p[2]||(p[2]=g=>l("C"))},"调整为 C级（忽略）")])],64)),n(e).gradeFinal?(o(),u("div",ye,[t("span",null,"当前等级："+v(n(e).gradeFinal.grade),1),n(e).gradeFinal.reason?(o(),u("small",ve,"理由："+v(n(e).gradeFinal.reason),1)):D("",!0)])):D("",!0)])):(o(),u("div",de,"请先完成 Step 1 并保存客户信息。"))])]),_:1}))}},ge=x(fe,[["__scopeId","data-v-861085d0"]]),be={class:"analysis"},ke={key:0,class:"analysis__loading"},we={key:1,class:"analysis__empty"},he={key:2,class:"analysis__body"},$e={class:"section"},xe={key:1,class:"text-block"},Se={class:"section"},Ce={key:1,class:"text-block"},Ne={class:"section"},Ie={key:1,class:"text-block"},De={class:"section"},Fe={key:1,class:"text-block"},Te=["disabled"],Ve={__name:"StepThree",setup(C){const e=S(),m=F("flowNav",{}),r=A(!1),l=()=>{!e.customerId||e.loading.analysis||e.analysis||e.fetchAnalysis()};U(()=>{l()});const d=()=>{l()},p=()=>{r.value=!r.value},g=async()=>{e.analysis&&(await e.persistAnalysis(),e.step=Math.max(e.step,4),m.goNext?.())};return(c,s)=>(o(),$(T,{step:3,total:5,title:"Step 3: 生成产品切入点分析",subtitle:"AI 根据客户信息生成可编辑的分析报告。"},{footer:w(()=>[t("button",{class:"ghost",type:"button",onClick:s[4]||(s[4]=a=>n(m).goPrev?.())},"返回上一步"),t("button",{class:"primary",type:"button",disabled:!n(e).analysis||n(e).loading.analysis,onClick:g}," 保存并继续 ",8,Te)]),default:w(()=>[t("section",be,[n(e).loading.analysis?(o(),u("div",ke,[...s[5]||(s[5]=[t("div",{class:"spinner"},null,-1),t("p",null,"正在生成切入点分析…",-1),t("small",null,"AI 正在为您深度分析客户需求，请稍候。",-1)])])):n(e).analysis?(o(),u("div",he,[t("header",null,[s[8]||(s[8]=t("h2",null,"AI 产品切入点建议",-1)),t("button",{type:"button",class:"ghost",onClick:p},[s[7]||(s[7]=t("span",{class:"material"},"edit",-1)),B(" "+v(r.value?"完成编辑":"编辑"),1)])]),t("div",$e,[s[9]||(s[9]=t("span",null,"客户核心业务",-1)),r.value?b((o(),u("textarea",{key:0,"onUpdate:modelValue":s[0]||(s[0]=a=>n(e).analysis.core_business=a),rows:"3"},null,512)),[[k,n(e).analysis.core_business]]):(o(),u("div",xe,v(n(e).analysis.core_business),1))]),t("div",Se,[s[10]||(s[10]=t("span",null,"潜在需求 / 痛点",-1)),r.value?b((o(),u("textarea",{key:0,"onUpdate:modelValue":s[1]||(s[1]=a=>n(e).analysis.pain_points=a),rows:"4"},null,512)),[[k,n(e).analysis.pain_points]]):(o(),u("div",Ce,v(n(e).analysis.pain_points),1))]),t("div",Ne,[s[11]||(s[11]=t("span",null,"我方切入点",-1)),r.value?b((o(),u("textarea",{key:0,"onUpdate:modelValue":s[2]||(s[2]=a=>n(e).analysis.my_entry_points=a),rows:"4"},null,512)),[[k,n(e).analysis.my_entry_points]]):(o(),u("div",Ie,v(n(e).analysis.my_entry_points),1))]),t("div",De,[s[12]||(s[12]=t("span",null,"完整报告",-1)),r.value?b((o(),u("textarea",{key:0,"onUpdate:modelValue":s[3]||(s[3]=a=>n(e).analysis.full_report=a),rows:"6"},null,512)),[[k,n(e).analysis.full_report]]):(o(),u("div",Fe,v(n(e).analysis.full_report),1))])])):(o(),u("div",we,[s[6]||(s[6]=t("p",null,"暂无分析内容，点击下方按钮生成。",-1)),t("button",{type:"button",class:"primary",onClick:d},"生成分析")]))])]),_:1}))}},Ae=x(Ve,[["__scopeId","data-v-1b73c9bc"]]),Ue={class:"mail-card"},Re={key:0,class:"mail-card__loading"},Me={key:1,class:"mail-card__empty"},qe={key:2,class:"mail-card__body"},Be=["disabled"],Ee={__name:"StepFour",setup(C){const e=S(),m=F("flowNav",{}),r=A(""),l=()=>{!e.customerId||e.loading.email||e.emailDraft||e.generateEmail()};U(()=>{l()});const d=()=>{l()},p=async()=>{e.emailDraft&&(await e.saveInitialFollowup(r.value),m.goNext?.())};return(g,c)=>(o(),$(T,{step:4,total:5,title:"Step 4: 生成个性化开发信",subtitle:"确认并微调邮件内容，保存为首次跟进记录。"},{footer:w(()=>[t("button",{class:"primary",type:"button",disabled:!n(e).emailDraft||n(e).loading.followup||n(e).loading.email,onClick:p},v(n(e).loading.followup?"保存中…":"保存为首次跟进记录"),9,Be)]),default:w(()=>[t("section",Ue,[n(e).loading.email?(o(),u("div",Re,[...c[3]||(c[3]=[t("div",{class:"spinner"},null,-1),t("p",null,"正在生成个性化开发信…",-1)])])):n(e).emailDraft?(o(),u("div",qe,[t("label",null,[c[5]||(c[5]=t("span",null,"邮件标题",-1)),b(t("input",{"onUpdate:modelValue":c[0]||(c[0]=s=>n(e).emailDraft.subject=s),type:"text"},null,512),[[k,n(e).emailDraft.subject]])]),t("label",null,[c[6]||(c[6]=t("span",null,"邮件正文",-1)),b(t("textarea",{"onUpdate:modelValue":c[1]||(c[1]=s=>n(e).emailDraft.body=s),rows:"12"},null,512),[[k,n(e).emailDraft.body]])]),t("label",null,[c[7]||(c[7]=t("span",null,"首次跟进备注（选填）",-1)),b(t("textarea",{"onUpdate:modelValue":c[2]||(c[2]=s=>r.value=s),rows:"4",placeholder:"记录与客户沟通的背景或期待的行动"},null,512),[[k,r.value]])])])):(o(),u("div",Me,[c[4]||(c[4]=t("p",null,"尚未生成开发信草稿，点击下方按钮立即生成。",-1)),t("button",{type:"button",class:"primary",onClick:d},"生成开发信")]))])]),_:1}))}},Le=x(Ee,[["__scopeId","data-v-0469c86e"]]),je={class:"schedule-card"},Ge={class:"options"},Oe=["disabled","onClick"],ze={key:0,class:"hint"},Pe={key:1,class:"status pending"},He={key:2,class:"status success"},Je={__name:"StepFive",setup(C){const e=S(),m=F("flowNav",{}),r=G(),l=[3,7,14],d=s=>{if(!e.scheduledTask||!e.scheduledTask.due_at)return!1;const a=new Date(e.scheduledTask.due_at),f=new Date(e.scheduledTask.created_at);return Number.isNaN(a.getTime())||Number.isNaN(f.getTime())?!1:Math.round((a-f)/(1e3*60*60*24))===s},p=s=>{e.emailDraft&&e.createSchedule(s)},g=s=>{if(!s)return"";const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toLocaleString()},c=()=>{e.resetFlow(),m.goTo?.(0),r.push({name:"home"})};return(s,a)=>(o(),$(T,{step:5,total:5,title:"Step 5: 设置自动化邮件跟进",subtitle:"选择合适的跟进时间，AI 会在约定日期自动发送邮件。"},{footer:w(()=>[t("button",{class:"primary",type:"button",onClick:c},"完成并开始下一个")]),default:w(()=>[t("section",je,[a[2]||(a[2]=t("h2",null,"设置自动跟进邮件",-1)),t("div",Ge,[(o(),u(V,null,M(l,f=>t("button",{key:f,type:"button",class:E(["option",{active:d(f)}]),disabled:n(e).loading.schedule||!n(e).emailDraft,onClick:R=>p(f)},v(f)+" 天后跟进 ",11,Oe)),64))]),n(e).emailDraft?D("",!0):(o(),u("p",ze,"需先保存开发信草稿才能安排自动跟进。")),n(e).loading.schedule?(o(),u("div",Pe,[...a[0]||(a[0]=[t("div",{class:"spinner"},null,-1),t("span",null,"正在创建跟进任务…",-1)])])):n(e).scheduledTask?(o(),u("div",He,[a[1]||(a[1]=t("span",{class:"material"},"check_circle",-1)),t("span",null,"任务设置成功！AI 将在 "+v(g(n(e).scheduledTask.due_at))+" 自动发送跟进邮件。",1)])):D("",!0)])]),_:1}))}},Ke=x(Je,[["__scopeId","data-v-a20957b7"]]),Qe={__name:"MainFlow",setup(C){const e=S(),m=[{id:1,component:re},{id:2,component:ge},{id:3,component:Ae},{id:4,component:Le},{id:5,component:Ke}],r=A(Math.max(0,e.step-1)),l=I(()=>Math.max(e.step-1,0)),d=I(()=>m[Math.min(r.value,m.length-1)]),p=()=>{r.value!==0&&(r.value-=1,s())},g=()=>{r.value>=m.length-1||r.value>=l.value||(r.value+=1,s())},c=a=>{a<0||a>=m.length||a>l.value||(r.value=a,s())},s=()=>{const a=r.value+1;a>e.step&&(e.step=a)};return N(()=>e.step,a=>{const f=Math.max(0,Math.min(a-1,m.length-1));f!==r.value&&(r.value=f)}),O("flowNav",{goPrev:p,goNext:g,goTo:c,activeIndex:I(()=>r.value),unlockIndex:l}),(a,f)=>(o(),$(P,{name:"flow-fade",mode:"out-in"},{default:w(()=>[(o(),$(z(d.value.component),{key:d.value.id}))]),_:1}))}},et=x(Qe,[["__scopeId","data-v-ff369837"]]);export{et as default};
