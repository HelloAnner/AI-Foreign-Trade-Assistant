import{y as S,z as p,_ as T,B as k,g as M,h as x,w as P,j as L,c as U,a as f,b as t,p as g,e as r,v as i,n as V,d as A,u as I,o as C}from"./index-BM-Gany5.js";import{h as d,F as B}from"./http-Erw2iPVe.js";const j=async()=>{const{data:a}=await d.get("/settings");return a},F=async a=>{const{data:e}=await d.put("/settings",a);return e},K=async()=>{const{data:a}=await d.post("/settings/test-llm");return a},O=async()=>{const{data:a}=await d.post("/settings/test-smtp");return a},R=async()=>{const{data:a}=await d.post("/settings/test-search");return a},D=S("settings",{state:()=>({loading:!1,data:{llm_base_url:"",llm_api_key:"",llm_model:"",my_company_name:"",my_product_profile:"",smtp_host:"",smtp_port:465,smtp_username:"",smtp_password:"",admin_email:"",rating_guideline:"",search_provider:"",search_api_key:""}}),actions:{async fetchSettings(){const a=p();this.loading=!0;try{const e=await j();e.ok?this.data={...this.data,...e.data}:e.error&&a.pushToast(e.error,"error")}catch(e){console.error("Failed to load settings",e),a.pushToast(e.message,"error")}finally{this.loading=!1}},async saveSettings(a){const e=p();this.loading=!0;try{const o=await F({...this.data,...a});if(o.ok){const l=o.data||a;this.data={...this.data,...l},e.pushToast("配置已保存","success")}else o.error&&e.pushToast(o.error,"error")}catch(o){console.error("Failed to save settings",o),e.pushToast(o.message,"error")}finally{this.loading=!1}},async testLLM(){const a=p();try{const e=await K();e.ok?a.pushToast(e.data.message||"LLM 测试成功","success"):a.pushToast(e.error||"LLM 测试失败","error")}catch(e){a.pushToast(e.message,"error")}},async testSMTP(){const a=p();try{const e=await O();e.ok?a.pushToast("测试邮件已发送，请检查邮箱","success"):a.pushToast(e.error||"SMTP 测试失败","error")}catch(e){a.pushToast(e.message,"error")}},async testSearch(){const a=p();try{const e=await R();if(e.ok){const o=e.data?.message||"搜索 API 测试成功";a.pushToast(o,"success")}else a.pushToast(e.error||"搜索测试失败","error")}catch(e){a.pushToast(e.message,"error")}}}}),N={class:"card"},z={class:"grid"},q={class:"card"},E={class:"grid"},G={class:"full"},H={class:"card"},J={class:"grid"},Q={class:"grid-two"},W={class:"card"},X={class:"card"},Y={class:"card"},Z={class:"grid"},$=["disabled"],tt=["disabled"],st={__name:"SettingsPage",setup(a){const e=D(),{data:o}=k(e),l=M({llm_base_url:"",llm_api_key:"",llm_model:"",my_company_name:"",my_product_profile:"",smtp_host:"",smtp_port:465,smtp_username:"",smtp_password:"",admin_email:"",rating_guideline:"",search_provider:"",search_api_key:""}),c=Object.keys(l);x(()=>{e.fetchSettings()}),P(o,u=>{u&&Object.assign(l,u)},{immediate:!0});const m=L(()=>o.value?c.some(u=>l[u]!==o.value[u]):c.some(u=>{const s=l[u];return s!==""&&s!==null&&s!==void 0})),y=async()=>m.value?(await e.saveSettings({...l}),!m.value):!0,_=async()=>{await e.saveSettings({...l})},v=async()=>{await y()&&await e.testLLM()},b=()=>{o.value&&Object.assign(l,o.value)},h=async()=>{await y()&&await e.testSMTP()},w=async()=>{await y()&&await e.testSearch()};return(u,s)=>(C(),U(B,{step:1,total:1,title:"全局配置",subtitle:"配置软件核心参数，保障 AI 助手稳定运行。"},{footer:f(()=>[t("button",{class:"ghost",type:"button",disabled:!m.value,onClick:b},"取消",8,$),t("button",{class:"primary",type:"button",disabled:I(e).loading,onClick:_},"保存更改",8,tt)]),default:f(()=>[t("form",{id:"settings-form",class:"settings-form",onSubmit:A(_,["prevent"])},[t("section",N,[t("header",null,[s[14]||(s[14]=t("div",null,[t("h2",null,"大模型 (LLM) 设置"),t("p",null,"配置 API 地址与密钥，用于智能分析与内容生成。")],-1)),t("button",{type:"button",class:"chip",onClick:v},[...s[13]||(s[13]=[t("span",{class:"material"},"bolt",-1),g(" 测试连接 ",-1)])])]),t("div",z,[t("label",null,[s[15]||(s[15]=t("span",null,"Base URL",-1)),r(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>l.llm_base_url=n),type:"text",placeholder:"https://api.example.com/v1"},null,512),[[i,l.llm_base_url]])]),t("label",null,[s[16]||(s[16]=t("span",null,"API Key",-1)),r(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>l.llm_api_key=n),type:"text",placeholder:"sk-…"},null,512),[[i,l.llm_api_key]])]),t("label",null,[s[17]||(s[17]=t("span",null,"模型名称",-1)),r(t("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>l.llm_model=n),type:"text",placeholder:"gpt-4o"},null,512),[[i,l.llm_model]])])])]),t("section",q,[s[20]||(s[20]=t("header",null,[t("div",null,[t("h2",null,"我的信息"),t("p",null,"这些信息将用于生成开发信签名与公司介绍。")])],-1)),t("div",E,[t("label",null,[s[18]||(s[18]=t("span",null,"我的公司名称",-1)),r(t("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>l.my_company_name=n),type:"text",placeholder:"例如：环球贸易有限公司"},null,512),[[i,l.my_company_name]])])]),t("label",G,[s[19]||(s[19]=t("span",null,"我的产品 / 服务简介",-1)),r(t("textarea",{"onUpdate:modelValue":s[4]||(s[4]=n=>l.my_product_profile=n),rows:"4",placeholder:"详细描述您的核心产品、优势和主要目标市场。"},null,512),[[i,l.my_product_profile]])])]),t("section",H,[t("header",null,[s[22]||(s[22]=t("div",null,[t("h2",null,"邮件发送 (SMTP) 设置"),t("p",null,"配置用于自动发送跟进邮件的 SMTP 服务器。")],-1)),t("button",{type:"button",class:"chip",onClick:h},[...s[21]||(s[21]=[t("span",{class:"material"},"send",-1),g(" 发送测试邮件 ",-1)])])]),t("div",J,[t("label",null,[s[23]||(s[23]=t("span",null,"SMTP 服务器",-1)),r(t("input",{"onUpdate:modelValue":s[5]||(s[5]=n=>l.smtp_host=n),type:"text",placeholder:"smtp.example.com"},null,512),[[i,l.smtp_host]])]),t("label",null,[s[24]||(s[24]=t("span",null,"端口",-1)),r(t("input",{"onUpdate:modelValue":s[6]||(s[6]=n=>l.smtp_port=n),type:"number",placeholder:"465"},null,512),[[i,l.smtp_port,void 0,{number:!0}]])]),t("label",null,[s[25]||(s[25]=t("span",null,"邮箱账号",-1)),r(t("input",{"onUpdate:modelValue":s[7]||(s[7]=n=>l.smtp_username=n),type:"text",placeholder:"your@email.com"},null,512),[[i,l.smtp_username]])]),t("label",null,[s[26]||(s[26]=t("span",null,"邮箱密码 / 授权码",-1)),r(t("input",{"onUpdate:modelValue":s[8]||(s[8]=n=>l.smtp_password=n),type:"password",placeholder:"授权码"},null,512),[[i,l.smtp_password]])])])]),t("section",Q,[t("div",W,[s[28]||(s[28]=t("header",null,[t("div",null,[t("h2",null,"系统设置"),t("p",null,"全局通知与默认管理员设置。")])],-1)),t("label",null,[s[27]||(s[27]=t("span",null,"管理员邮箱",-1)),r(t("input",{"onUpdate:modelValue":s[9]||(s[9]=n=>l.admin_email=n),type:"email",placeholder:"用于接收系统通知"},null,512),[[i,l.admin_email]])])]),t("div",X,[s[29]||(s[29]=t("header",null,[t("div",null,[t("h2",null,"客户评级标准"),t("p",null,"以自然语言描述您的 A/B/C 客户定义。")])],-1)),r(t("textarea",{"onUpdate:modelValue":s[10]||(s[10]=n=>l.rating_guideline=n),rows:"8",placeholder:`例如：
A级：明确表达采购意向，有具体需求和预算；
B级：对产品感兴趣，正在评估供应商；
C级：暂无明确需求，仅收集资料。`},null,512),[[i,l.rating_guideline]])])]),t("section",Y,[t("header",null,[s[31]||(s[31]=t("div",null,[t("h2",null,"搜索 API 设置"),t("p",null,"配置用于外部情报搜索的 API。")],-1)),t("button",{type:"button",class:"chip",onClick:w},[...s[30]||(s[30]=[t("span",{class:"material"},"travel_explore",-1),g(" 测试搜索 ",-1)])])]),t("div",Z,[t("label",null,[s[33]||(s[33]=t("span",null,"搜索提供商",-1)),r(t("select",{"onUpdate:modelValue":s[11]||(s[11]=n=>l.search_provider=n)},[...s[32]||(s[32]=[t("option",{value:""},"未配置（直连模式）",-1),t("option",{value:"serpapi"},"SerpAPI",-1)])],512),[[V,l.search_provider]])]),t("label",null,[s[34]||(s[34]=t("span",null,"API Key",-1)),r(t("input",{"onUpdate:modelValue":s[12]||(s[12]=n=>l.search_api_key=n),type:"text",placeholder:"SerpAPI Key"},null,512),[[i,l.search_api_key]])])])])],32)]),_:1}))}},at=T(st,[["__scopeId","data-v-62b12e74"]]);export{at as default};
