import{d as k,u as p,_ as T,s as b,k as M,l as w,w as L,c as g,a as s,b as r,t as _,m as P,h as f,f as y,p as I,v as A,i as x,o as h}from"./index-DaYgWqEB.js";import{h as c}from"./http-CZPNIr2s.js";const B=async()=>{const{data:a}=await c.get("/settings");return a},C=async a=>{const{data:e}=await c.put("/settings",a);return e},U=async()=>{const{data:a}=await c.post("/settings/test-llm");return a},V=async()=>{const{data:a}=await c.post("/settings/test-smtp");return a},R=async()=>{const{data:a}=await c.post("/settings/test-search");return a},D=k("settings",{state:()=>({loading:!1,data:{llm_base_url:"",llm_api_key:"",llm_model:"",my_company_name:"",my_product_profile:"",smtp_host:"",smtp_port:465,smtp_username:"",smtp_password:"",admin_email:"",rating_guideline:"",search_provider:"",search_api_key:""}}),actions:{async fetchSettings(){const a=p();this.loading=!0;try{const e=await B();e.ok?this.data={...this.data,...e.data}:e.error&&a.pushToast(e.error,"error")}catch(e){console.error("Failed to load settings",e),a.pushToast(e.message,"error")}finally{this.loading=!1}},async saveSettings(a){const e=p();this.loading=!0;try{const o=await C({...this.data,...a});o.ok?(this.data={...this.data,...a},e.pushToast("配置已保存","success")):o.error&&e.pushToast(o.error,"error")}catch(o){console.error("Failed to save settings",o),e.pushToast(o.message,"error")}finally{this.loading=!1}},async testLLM(){const a=p();try{const e=await U();e.ok?a.pushToast(e.data.message||"LLM 测试成功","success"):a.pushToast(e.error||"LLM 测试失败","error")}catch(e){a.pushToast(e.message,"error")}},async testSMTP(){const a=p();try{const e=await V();e.ok?a.pushToast("测试邮件已发送，请检查邮箱","success"):a.pushToast(e.error||"SMTP 测试失败","error")}catch(e){a.pushToast(e.message,"error")}},async testSearch(){const a=p();try{const e=await R();e.ok?a.pushToast("搜索 API 测试成功","success"):a.pushToast(e.error||"搜索测试失败","error")}catch(e){a.pushToast(e.message,"error")}}}}),F={class:"settings-page"},K={class:"settings-page__body"},N={key:0,class:"settings-preview"},z={class:"settings-preview__card"},E={class:"settings-preview__card"},j={key:1,class:"settings-page__loading"},q={class:"search-config__fields"},G={class:"search-config__field"},H={class:"search-config__field"},J=["disabled"],O={__name:"SettingsPage",setup(a){const e=x(),o=D(),{data:d,loading:m}=b(o),i=M({search_provider:"",search_api_key:""});w(()=>{o.fetchSettings()});const u=l=>l||"未配置";L(d,l=>{l&&(i.search_provider=l.search_provider||"",i.search_api_key=l.search_api_key||"")},{immediate:!0});const S=()=>{o.saveSettings({search_provider:i.search_provider,search_api_key:i.search_api_key})},v=()=>{e.push({name:"home"})};return(l,t)=>(h(),g("div",F,[s("header",{class:"settings-page__header"},[s("button",{class:"settings-page__back",onClick:v},"返回"),t[5]||(t[5]=s("h1",{class:"settings-page__title"},"全局配置",-1))]),s("section",K,[t[17]||(t[17]=s("p",{class:"settings-page__intro"}," 在这里配置 LLM、SMTP、客户评级标准及搜索 API。当前页面为功能骨架，随开发推进将补齐完整表单与交互。 ",-1)),r(m)?(h(),g("div",j,"正在加载配置...")):(h(),g("div",N,[s("article",z,[t[8]||(t[8]=s("h2",null,"大模型设置",-1)),s("dl",null,[s("div",null,[t[6]||(t[6]=s("dt",null,"Base URL",-1)),s("dd",null,_(u(r(d).llm_base_url)),1)]),s("div",null,[t[7]||(t[7]=s("dt",null,"模型名称",-1)),s("dd",null,_(u(r(d).llm_model)),1)])]),s("button",{class:"link-button",onClick:t[0]||(t[0]=(...n)=>r(o).testLLM&&r(o).testLLM(...n))},"测试 LLM 连通性")]),s("article",E,[t[11]||(t[11]=s("h2",null,"邮件设置",-1)),s("dl",null,[s("div",null,[t[9]||(t[9]=s("dt",null,"SMTP 主机",-1)),s("dd",null,_(u(r(d).smtp_host)),1)]),s("div",null,[t[10]||(t[10]=s("dt",null,"管理员邮箱",-1)),s("dd",null,_(u(r(d).admin_email)),1)])]),s("button",{class:"link-button",onClick:t[1]||(t[1]=(...n)=>r(o).testSMTP&&r(o).testSMTP(...n))},"发送测试邮件")])])),s("form",{class:"search-config",onSubmit:P(S,["prevent"])},[t[15]||(t[15]=s("h3",{class:"search-config__title"},"搜索 API",-1)),t[16]||(t[16]=s("p",{class:"search-config__remark"},[f(" 推荐使用 "),s("span",null,"SerpAPI"),f("（https://serpapi.com/search-api），成功配置后系统可自动调用真实搜索结果。 ")],-1)),s("div",q,[s("label",G,[t[13]||(t[13]=s("span",null,"搜索提供商",-1)),y(s("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>i.search_provider=n)},[...t[12]||(t[12]=[s("option",{value:""},"未配置（直连模式）",-1),s("option",{value:"serpapi"},"SerpAPI",-1)])],512),[[I,i.search_provider]])]),s("label",H,[t[14]||(t[14]=s("span",null,"API Key",-1)),y(s("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>i.search_api_key=n),type:"text",placeholder:"填入 SerpAPI Key",autocomplete:"off"},null,512),[[A,i.search_api_key]])])]),s("button",{class:"search-config__submit",type:"submit",disabled:r(m)}," 保存搜索配置 ",8,J),s("button",{class:"link-button",type:"button",onClick:t[4]||(t[4]=(...n)=>r(o).testSearch&&r(o).testSearch(...n))}," 测试搜索 API ")],32)])]))}},X=T(O,[["__scopeId","data-v-62fdafc4"]]);export{X as default};
