import{g as T,h as p,_ as k,C as M,D as P,E as x,w as V,k as L,c as U,b as t,d as A,e as m,G as I,q as r,v as i,H as C,s as B,u as K,o as D}from"./index-CNRjy-lW.js";import{h as y}from"./http-CZPNIr2s.js";const N=async()=>{const{data:l}=await y.get("/settings");return l},R=async l=>{const{data:e}=await y.put("/settings",l);return e},j=async()=>{const{data:l}=await y.post("/settings/test-llm");return l},E=async()=>{const{data:l}=await y.post("/settings/test-smtp");return l},F=async()=>{const{data:l}=await y.post("/settings/test-search");return l},H=T("settings",{state:()=>({loading:!1,data:{llm_base_url:"",llm_api_key:"",llm_model:"",my_company_name:"",my_product_profile:"",smtp_host:"",smtp_port:465,smtp_username:"",smtp_password:"",admin_email:"",rating_guideline:"",search_provider:"",search_api_key:""}}),actions:{async fetchSettings(){const l=p();this.loading=!0;try{const e=await N();e.ok?this.data={...this.data,...e.data}:e.error&&l.pushToast(e.error,"error")}catch(e){console.error("Failed to load settings",e),l.pushToast(e.message,"error")}finally{this.loading=!1}},async saveSettings(l){const e=p();this.loading=!0;try{const o=await R({...this.data,...l});if(o.ok){const d=o.data||l;this.data={...this.data,...d},e.pushToast("配置已保存","success")}else o.error&&e.pushToast(o.error,"error")}catch(o){console.error("Failed to save settings",o),e.pushToast(o.message,"error")}finally{this.loading=!1}},async testLLM(){const l=p();try{const e=await j();e.ok?l.pushToast(e.data.message||"LLM 测试成功","success"):l.pushToast(e.error||"LLM 测试失败","error")}catch(e){l.pushToast(e.message,"error")}},async testSMTP(){const l=p();try{const e=await E();e.ok?l.pushToast("测试邮件已发送，请检查邮箱","success"):l.pushToast(e.error||"SMTP 测试失败","error")}catch(e){l.pushToast(e.message,"error")}},async testSearch(){const l=p();try{const e=await F();if(e.ok){const o=e.data?.message||"搜索 API 测试成功";l.pushToast(o,"success")}else l.pushToast(e.error||"搜索测试失败","error")}catch(e){l.pushToast(e.message,"error")}}}}),O={class:"settings-shell"},q={class:"main"},G={class:"card"},z={class:"grid"},J={class:"card"},Q={class:"grid"},W={class:"card"},X={class:"grid"},Y={class:"grid-two"},Z={class:"card"},$={class:"card card--stretch"},tt={class:"card"},st={class:"grid"},et={class:"form-footer"},at=["disabled"],lt={__name:"SettingsPage",setup(l){const e=K(),o=H(),{data:d}=M(o),a=P({llm_base_url:"",llm_api_key:"",llm_model:"",my_company_name:"",my_product_profile:"",smtp_host:"",smtp_port:465,smtp_username:"",smtp_password:"",admin_email:"",rating_guideline:"",search_provider:"",search_api_key:""}),c=Object.keys(a);x(()=>{o.fetchSettings()}),V(d,u=>{u&&Object.assign(a,u)},{immediate:!0});const g=L(()=>d.value?c.some(u=>a[u]!==d.value[u]):c.some(u=>{const s=a[u];return s!==""&&s!==null&&s!==void 0})),b=async()=>g.value?(await o.saveSettings({...a}),!g.value):!0,f=async()=>{await o.saveSettings({...a})},_=async()=>{await b()&&await o.testLLM()},S=async()=>{await b()&&await o.testSMTP()},h=async()=>{await b()&&await o.testSearch()},v=()=>{e.push({name:"home"})},w=()=>{v()};return(u,s)=>(D(),U("div",O,[t("aside",{class:"sidebar"},[s[15]||(s[15]=t("div",{class:"brand"},[t("div",{class:"avatar"}),t("div",null,[t("p",{class:"brand-title"},"AI外贸助手"),t("p",{class:"brand-sub"},"专业版")])],-1)),t("nav",{class:"menu"},[t("button",{class:"menu-item",type:"button",onClick:v},[...s[13]||(s[13]=[t("span",{class:"material"},"search",-1),m(" 客户开发 ",-1)])]),s[14]||(s[14]=A('<button class="menu-item" data-v-eedfa6b7><span class="material" data-v-eedfa6b7>group</span> 客户管理 </button><button class="menu-item" data-v-eedfa6b7><span class="material" data-v-eedfa6b7>mail</span> 邮件营销 </button><button class="menu-item" data-v-eedfa6b7><span class="material" data-v-eedfa6b7>bar_chart</span> 数据分析 </button><button class="menu-item menu-item--active" data-v-eedfa6b7><span class="material" data-v-eedfa6b7>settings</span> 全局配置 </button>',4))])]),t("main",q,[t("header",{class:"page-head"},[s[17]||(s[17]=t("div",null,[t("h1",null,"全局配置"),t("p",null,"配置软件核心参数以确保 AI 助手正常运行。")],-1)),t("button",{class:"ghost",type:"button",onClick:w},[...s[16]||(s[16]=[t("span",{class:"material"},"arrow_back",-1),m(" 返回 ",-1)])])]),t("form",{class:"form",onSubmit:I(f,["prevent"])},[t("section",G,[t("header",null,[s[19]||(s[19]=t("div",null,[t("h2",null,"大模型 (LLM) 设置"),t("p",null,"配置 API 地址与密钥，用于智能分析与内容生成。")],-1)),t("button",{type:"button",class:"chip",onClick:_},[...s[18]||(s[18]=[t("span",{class:"material"},"bolt",-1),m(" 测试连接 ",-1)])])]),t("div",z,[t("label",null,[s[20]||(s[20]=t("span",null,"Base URL",-1)),r(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>a.llm_base_url=n),type:"text",placeholder:"https://api.example.com/v1"},null,512),[[i,a.llm_base_url]])]),t("label",null,[s[21]||(s[21]=t("span",null,"API Key",-1)),r(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>a.llm_api_key=n),type:"text",placeholder:"sk-..."},null,512),[[i,a.llm_api_key]])]),t("label",null,[s[22]||(s[22]=t("span",null,"模型名称",-1)),r(t("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>a.llm_model=n),type:"text",placeholder:"gpt-4o"},null,512),[[i,a.llm_model]])])])]),t("section",J,[s[25]||(s[25]=t("header",null,[t("div",null,[t("h2",null,"我的信息"),t("p",null,"这些信息将用于生成开发信签名与公司介绍。")])],-1)),t("div",Q,[t("label",null,[s[23]||(s[23]=t("span",null,"我的公司名称",-1)),r(t("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>a.my_company_name=n),type:"text",placeholder:"例如：环球贸易有限公司"},null,512),[[i,a.my_company_name]])])]),t("label",null,[s[24]||(s[24]=t("span",null,"我的产品 / 服务简介",-1)),r(t("textarea",{"onUpdate:modelValue":s[4]||(s[4]=n=>a.my_product_profile=n),rows:"4",placeholder:"详细描述您的核心产品、优势和主要目标市场。"},null,512),[[i,a.my_product_profile]])])]),t("section",W,[t("header",null,[s[27]||(s[27]=t("div",null,[t("h2",null,"邮件发送 (SMTP) 设置"),t("p",null,"配置用于自动发送跟进邮件的 SMTP 服务器。")],-1)),t("button",{type:"button",class:"chip",onClick:S},[...s[26]||(s[26]=[t("span",{class:"material"},"send",-1),m(" 发送测试邮件 ",-1)])])]),t("div",X,[t("label",null,[s[28]||(s[28]=t("span",null,"SMTP 服务器",-1)),r(t("input",{"onUpdate:modelValue":s[5]||(s[5]=n=>a.smtp_host=n),type:"text",placeholder:"smtp.example.com"},null,512),[[i,a.smtp_host]])]),t("label",null,[s[29]||(s[29]=t("span",null,"端口",-1)),r(t("input",{"onUpdate:modelValue":s[6]||(s[6]=n=>a.smtp_port=n),type:"number",placeholder:"465"},null,512),[[i,a.smtp_port,void 0,{number:!0}]])]),t("label",null,[s[30]||(s[30]=t("span",null,"邮箱账号",-1)),r(t("input",{"onUpdate:modelValue":s[7]||(s[7]=n=>a.smtp_username=n),type:"text",placeholder:"your@email.com"},null,512),[[i,a.smtp_username]])]),t("label",null,[s[31]||(s[31]=t("span",null,"邮箱密码 / 授权码",-1)),r(t("input",{"onUpdate:modelValue":s[8]||(s[8]=n=>a.smtp_password=n),type:"password",placeholder:"授权码"},null,512),[[i,a.smtp_password]])])])]),t("section",Y,[t("div",Z,[s[33]||(s[33]=t("header",null,[t("div",null,[t("h2",null,"系统设置"),t("p",null,"全局通知与默认管理员设置。")])],-1)),t("label",null,[s[32]||(s[32]=t("span",null,"管理员邮箱",-1)),r(t("input",{"onUpdate:modelValue":s[9]||(s[9]=n=>a.admin_email=n),type:"email",placeholder:"用于接收系统通知"},null,512),[[i,a.admin_email]])])]),t("div",$,[s[34]||(s[34]=t("header",null,[t("div",null,[t("h2",null,"客户评级标准"),t("p",null,"以自然语言描述您的 A/B/C 客户定义。")])],-1)),r(t("textarea",{"onUpdate:modelValue":s[10]||(s[10]=n=>a.rating_guideline=n),rows:"8",placeholder:`例如：
A级：明确表达采购意向，有具体需求和预算；
B级：对产品感兴趣，正在评估供应商；
C级：暂无明确需求，仅收集资料。`},null,512),[[i,a.rating_guideline]])])]),t("section",tt,[t("header",null,[s[36]||(s[36]=t("div",null,[t("h2",null,"搜索 API 设置"),t("p",null,"配置用于外部情报搜索的 API。")],-1)),t("button",{type:"button",class:"chip",onClick:h},[...s[35]||(s[35]=[t("span",{class:"material"},"travel_explore",-1),m(" 测试搜索 ",-1)])])]),t("div",st,[t("label",null,[s[38]||(s[38]=t("span",null,"搜索提供商",-1)),r(t("select",{"onUpdate:modelValue":s[11]||(s[11]=n=>a.search_provider=n)},[...s[37]||(s[37]=[t("option",{value:""},"未配置（直连模式）",-1),t("option",{value:"serpapi"},"SerpAPI",-1)])],512),[[C,a.search_provider]])]),t("label",null,[s[39]||(s[39]=t("span",null,"API Key",-1)),r(t("input",{"onUpdate:modelValue":s[12]||(s[12]=n=>a.search_api_key=n),type:"text",placeholder:"SerpAPI Key"},null,512),[[i,a.search_api_key]])])])]),t("footer",et,[t("button",{class:"primary",type:"submit",disabled:B(o).loading},"保存配置",8,at)])],32)])]))}},rt=k(lt,[["__scopeId","data-v-eedfa6b7"]]);export{rt as default};
