Step 1：输入客户公司名，自动拉取国家、官网、联系人信息；
Step 2：自动按ABC评级分级客户价值；
Step 3：如果是A级客户，自动展开调研 ，生成产品切入点；
Step 4：AI生成个性化开发信，自带客户痛点 + 产品解决点；
Step 5：自动保存跟进记录 + 设置提醒；

---

### 1. 项目目标

实现从 `客户识别 -> 智能评级 -> 深度分析 -> 个性化触达 -> 自动化跟进` 的全流程智能化

### 2. 核心技术架构

- **运行方式**: 本地化运行的软件。客户双击 `exe` 可执行文件后，在本地启动一个轻量级 Web 服务器。
- **部署策略**: 官方 `scripts/start.sh` 以 Docker `--network host` 模式运行容器，直接复用宿主机网络，应用默认监听 `0.0.0.0:7860`，可通过 `APP_PORT` 或 `APP_HTTP_ADDR` 环境变量自定义端口/地址。
- **用户界面**: 用户通过默认浏览器访问本地地址 (如 `http://127.0.0.1:7860`) 进行所有操作。
- **数据存储**: 所有数据存储在本地。使用 **SQLite** 数据库，用于保存全局配置、客户信息、跟进记录、任务计划等。确保数据私密性和安全性。 存储在用户目录下的 ./foreign_trade 文件夹下, 其他配置和文件都存储在这个文件夹下
- **AI 核心**: 通过连接用户在全局配置中指定的大模型 API，为软件的每一步提供强大的智能分析与内容生成能力。

### 3. 核心工作流 (单页面线性流程)

用户完成一步后，结果会展示在下方, 实现自动翻页，并自动解锁下一步操作。

### 4. 安全访问控制（2025-11-21 全量方案）

- **访问入口**：新增 `/login` 登录页（风格与主流程一致），所有前端路由在进入前都会检查 JWT。缺少或过期 token 时，路由守卫与 Axios 拦截器都会立即跳转到登录页。
- **默认口令**：初始管理员口令固定为 `foreign_123_login`，可用 `FTA_LOGIN_PASSWORD` 覆盖；强烈建议首次部署后立即修改。
- **RSA 加密链路**：
  - 后端启动时动态生成 2048 位 RSA 密钥对，仅在内存中保存私钥，并通过 `GET /api/auth/public-key` 暴露 PEM 格式公钥（返回 `kid`、算法、生成时间），前端在运行期实时拉取，不再在 bundle 中硬编码任何密钥，“浏览器看不到密钥注入”。
  - 登录口令、LLM API Key、DS 密码、邮箱密码等全部敏感字段在前端通过 WebCrypto `RSA-OAEP-256` 加密，统一以 `rsa:` 前缀传输；后端按前缀自动解密后再落库或透传至服务层。
  - 为兼容旧版本，后端仍支持历史 `enc:` AES-GCM 密文（密钥取自 `FTA_ENCRYPTION_KEY`），但前端已默认使用 RSA；如启用桌面离线版本，请确保 `FTA_ENCRYPTION_KEY` 仍然配置。
- **令牌策略**：口令校验成功后生成 HS256 JWT（`issuer=ai-foreign-trade-assistant`），默认 14 天有效，通过 `FTA_JWT_SECRET`、`FTA_LOGIN_PASSWORD`、`FTA_JWT_TTL` 可自定义。服务端同步下发 HttpOnly Cookie，前端在 `localStorage` 保存（token + 过期时间）用于 Axios Authorization 头。
- **鉴权中间件**：`/api/auth/login` 与 `/api/auth/public-key` 之外的接口全部挂载 JWT 中间件，401 时返回统一错误；前端拦截器收到 401 会清空本地 token 并强制跳转 `/login`。
- **密钥轮转**：若需要强制刷新前端使用的公钥，可重启后端或在运行中调用热更新逻辑（后续版本可扩展），前端在下次调用 `encryptValue` 时会自动重新获取；必要时可通过清除缓存强制刷新。
- **SMTP 加密**：全局配置新增“加密方式”字段，可在 `SSL（端口 465）` 与 `TLS/STARTTLS（端口 587）` 间切换；后端据此强制 `gomail.Dialer.SSL` 或 STARTTLS，确保各邮箱服务的兼容性。

### 5. 数据目录与日志策略（2025-11-21 更新）

- **数据挂载目录**：默认仍写入 `~/.foreign_trade`，如需在 Docker 中将所有数据库、配置、日志落盘到宿主机，可设置环境变量 `FTA_DATA_DIR=/data/ai-fta` 并把该路径挂载为持久卷（例如 `-v /opt/fta-data:/data/ai-fta`）。
- **目录结构**：`FTA_DATA_DIR`（或默认 home 目录）下会自动创建 `app.db`、`config.json`、`logs/`、`cache/`、`exports/` 等文件夹，保证“运行期间的日志和数据”统一出现在挂载目录中。
- **日志落地**：`logs/app.log` 与 STDOUT 同步输出，使用 `rotatelogs` 每天轮转，历史文件自动压缩为 `.log.gz`，满足“日志每日自动压缩”要求。
- **故障追踪**：SMTP 测试、自动邮件发送等关键路径一旦失败，会把原始错误与完整 `runtime/debug.Stack()` 堆栈写入日志文件，便于定位如“测试邮件失败”类问题；日志中仅包含主机、端口、账号等必要信息，不输出密码。

---

### **主界面**

一个极致简洁的页面，聚焦于核心任务。

- **页面元素**:
    1. 标题：“AI 外贸客户开发助手”。
    2. 输入框，提示文字为“输入客户公司全名或官网地址”。
    3. 一个“开始分析”按钮。
    4. 一个右上角落里的“设置”图标，用于进入全局配置页面。

![screen.png](attachment:175e6a05-1651-457f-bf5a-8f2b66a404eb:screen.png)

---

### **Step 1: 智能信息获取与聚合**

- **需求描述**: 用户输入公司名，系统不仅要找到官网和联系方式，更要利用 LLM 理解和聚合初步信息。
- **页面与流程**:
    1. 用户输入公司名（如 "Global Tech Inc."），点击“开始分析”。
    2. **LLM 驱动的智能搜索**:
        - 系统调用搜索引擎 API 进行多维度搜索。
        - LLM **实时分析搜索结果**，从多个网页摘要中识别出最权威的官方网站，避免领英页面或B2B平台页面的干扰。
        - LLM 自动访问官网（或其“关于我们”、“联系我们”页面），提取并解析出关键信息。
    3. 搜索完成后，结果以卡片形式清晰展示：
        - **公司官网**: `www.globaltech.com` (AI 识别的最相关网址)
        - **国家/地区**: `United States` (AI 从版权、联系地址等信息中推断)
        - **潜在联系人**:
            - `info@globaltech.com` (通用邮箱)
            - `sales@globaltech.com` (职能邮箱)
            - `john.doe@globaltech.com` (CEO, Purchasing Manager - AI 识别出的关键人物及其职位)
    4. **手动校准**: 所有信息均为可编辑文本框，用户可以轻松修正或补充，确保信息100%准确。

![screen.png](attachment:7cab71a5-2136-48f2-b775-7831eab5dd29:screen.png)

---

### **Step 2: AI 辅助客户价值评级**

- **需求描述**: 基于用户预设的标准，AI 自动对客户进行价值评估，并给出评级建议。
- **页面与流程**:
    1. 在 Step 1 的结果下方，系统显示“AI 正在进行价值评估...”。
    2. **LLM 智能评估**:
        - AI 会根据用户在**全局配置**中设定的“评级标准”（例如：“A级客户是消费电子行业，网站提到创新或高端市场”），对 Step 1 中获取的官网内容进行深度分析。
        - AI 分析公司的业务范围、产品定位、市场地位、官网传达的价值观等。
    3. 评估完成后，系统会**推荐一个评级**，并给出理由：
        - **AI 建议**: **A级 (重点开发)**
        - **AI 理由**: “该公司官网重点展示了其在高端智能吸尘器领域的创新，符合您设定的‘消费电子’和‘高端市场’标准。”
    4. 用户根据 AI 的建议，点击最终确认按钮：
        - **[ 确认 A级 (继续分析) ]**
        - **[ 调整为 B级 (归档) ]**
        - **[ 调整为 C级 (忽略) ]**
    5. 如果用户选择 B 或 C 级，系统会将客户信息存入本地数据库并归档，流程结束。如果选择 A 级，则自动进入下一步。

![screen.png](attachment:167f59ed-00d0-4871-a948-b633e49bf48b:screen.png)

---

### **Step 3: 生成产品切入点分析**

- **需求描述**: 对于 A 级客户，LLM 深度分析其业务，并结合**用户自身的产品优势**，生成精准的产品切入点。
- **页面与流程**:
    1. 用户确认“A级”后，系统显示“正在生成切入点分析...”。
    2. **LLM 深度分析**:
        - AI 结合 Step 1 和 Step 2 的信息，并与**全局配置**中用户输入的“我的产品/服务简介”进行交叉分析。
        - 它会寻找客户的**潜在痛点**或**需求点**，并思考用户的产品如何能满足这些需求。
    3. 分析完成后，生成名为 **“AI 产品切入点建议”** 的报告 (注意可能有多家A类客户和报告)：
        - **客户核心业务**: “该公司主营高端智能吸尘器，核心卖点是‘长续航’和‘智能路径规划’。”
        - **潜在需求/痛点**: “为维持‘长续航’的领先地位，他们可能持续寻求更高能量密度、更长寿命的电池解决方案。”
        - **我方切入点**: “我们的‘高容量锂电池’可以直接对标其‘长续航’卖点，可作为其下一代产品的核心竞争力升级方案。”
    4. 此分析报告是生成开发信的基石，用户可编辑。

![screen.png](attachment:3ca9f3a6-e8fd-4349-b7b7-b5a50f3a155c:screen.png)

---

### **Step 4: 生成个性化开发信并保存记录**

- **需求描述**: 一键生成高度个性化的开发信初稿，并将其作为跟进记录保存到本地。
- **页面与流程**:
    1. 在“切入点建议”下方，有一个 **“生成开发信”** 按钮。
    2. 点击后，LLM 会基于 Step 3 的分析，并使用用户在**全局配置**中的公司信息，草拟一封邮件。
    3. 邮件草稿直接显示在页面上，包含**标题**和**正文**：
        - **标题**: Re: Enhancing the "Long-Endurance" of Global Tech's Smart Vacuums
        - **正文**: “...注意到贵司官网强调了产品的‘长续航’能力，这正是我们的专长所在。作为专业的‘高容量锂电池’供应商，我们相信能为您的下一代产品提供更有竞争力的电源解决方案，进一步巩固您的市场领先地位...”
    4. 用户可以在文本框内对邮件进行最后修改。
    5. 邮件草稿下方是一个 **“保存为首次跟进记录”** 按钮。
    6. 点击后，系统将**当前邮件的全部内容、客户信息、日期**等存入本地 SQLite 数据库。**此步骤不发送邮件**，而是记录下用户将要（或已经）手动发送的内容，作为后续跟进的上下文。

![screen.png](attachment:4f4ad058-bbeb-4f65-b466-3d2e5039655a:screen.png)

---

### **Step 5: 设置自动化邮件跟进**

- **需求描述**: 在首次接触后，轻松设置一个智能化的自动邮件跟进任务。
- **页面与流程**:
    1. 当 Step 4 记录保存后，页面下方出现新的操作选项：
        - 一个标题：“设置自动跟进邮件”。
        - 几个快捷按钮：**[ 3天后跟进 ]** **[ 7天后跟进 ]** **[ 14天后跟进 ]**
        - 一个“完成并开始下一个”按钮。
    2. 用户点击一个时间按钮（例如“7天后跟进”）。
    3. 系统弹出提示：“已设置任务：7天后将自动发送一封跟进邮件。”
    4. **后台任务**:
        - 系统会在本地数据库的 `scheduled_tasks` 表中创建一条记录。
        - 到达指定日期时，本地程序会触发一个任务：
            1. 调用 LLM，并提供**首次开发信的内容**作为上下文。
            2. 要求 LLM 生成一封**简短、友好、提供新价值**的跟进邮件（例如，补充一个案例或一个技术参数）。
            3. 使用用户在**全局配置**中设置的 **SMTP 服务器信息**，自动发送这封邮件。
            4. 发送成功后，在数据库中记录下这次自动跟进的内容和时间。
    5. 用户点击 **“完成并开始下一个”**，页面重置，可以开始分析下一个客户。

![screen.png](attachment:ee303172-13ea-4fdd-b272-9b12c84b10ef:screen.png)

---

### **全局配置页面**

通过主界面的“设置”图标进入，用于软件的核心参数配置。

- **1. 大模型 (LLM) 设置**:
    - **Base URL**: `输入您的大模型 API 地址`
    - **API Key**: `输入您的 API 密钥`
    - **模型名称**: `例如：gpt-4-turbo, claude-3-opus`
    - 一个 **[ 测试连接 ]** 按钮，以验证配置是否正确。
- **2. 我的信息 (用于邮件生成)**:
    - **我的公司名**: `输入您的公司名称`
    - **我的产品/服务简介**: (文本框) `详细描述您的核心产品、优势和目标市场。描述越详细，AI 生成的内容越精准。`
- **3. 邮件发送 (SMTP) 设置 (用于自动跟进)**:
    - **SMTP 服务器**: `例如：smtp.example.com`
    - **端口**: `例如：465`
    - **邮箱账号**: `您的发件邮箱`
    - **邮箱密码/授权码**: `输入密码或授权码`
    - 一个 **[ 发送测试邮件 ]** 按钮，向管理员邮箱发送一封测试邮件。
- **4. 系统设置**:
    - **管理员邮箱**: `用于接收系统通知和测试邮件`
- **5. 客户评级标准 (AI评估依据)**:
    - 一个大的文本框，标签为“请用自然语言描述您的客户分级标准”。
    - 提示文字示例：“A级客户：消费电子行业的终端品牌，官网有创新、研发等关键词。B级客户：相关行业的制造商或大型分销商。C级客户：小型贸易商或信息不明确的公司。”

---

![screen.png](attachment:8644fcb3-21b6-495a-bb8c-28b6767d74ee:screen.png)

https://stitch.withgoogle.com/projects/3492005361938105857
